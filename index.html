<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>HTML-bezume Idle Capybara</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --text:#eef2f7; --muted:#a8b3c7; --card:#1d2333; --border:#2a3247;
      --accent:#7bd389; --accent2:#7bb3ff; --accent3:#ff7bd3;
      --danger:#ff6b6b; --ok:#58b873;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body {
      margin:0; 
      font-family:Inter,system-ui,Segoe UI,Arial,sans-serif;
      color:var(--text);
      background-color: #0b0e1c !important;
      position: relative;
      min-height: 100vh;
      overflow-x: hidden;
    }

    /* –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–Ω–µ–∂–∏–Ω–∫–∏ –Ω–∞ –ß–Å–†–ù–û–ú –§–û–ù–ï */
    .snowflakes {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: 1;
      background-color: #0b0e1c;
    }
    .snowflake {
      position: absolute;
      background: rgba(255, 255, 255, 0.8);
      border-radius: 50%;
      animation: fall linear infinite;
    }
    @keyframes fall {
      to { 
        transform: translateY(100vh) rotate(360deg); 
      }
    }

    /* Neon gradient text */
    .neon {
      background: linear-gradient(90deg, #7c5cff, #00d4ff, #7c5cff);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 0 8px rgba(124,92,255,.25), 0 0 14px rgba(0,212,255,.18);
    }

    .wrap {
      position: relative;
      z-index: 10;
      background-color: transparent;
    }

    header{
      display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; 
      background-color: transparent !important;
    }
    h1{margin:0; font-size:24px; font-weight:900; letter-spacing:.2px}
    .badge{background:var(--accent); color:#0b121f; padding:6px 10px; border-radius:10px; font-weight:800; font-size:12px}
    .grid2{display:grid; grid-template-columns:1fr; gap:16px;}
    @media(min-width:860px) {.grid2{grid-template-columns:1.2fr .8fr}}
    .card{
      background:linear-gradient(180deg, #113d2e 0%, #171d3a 100%) !important;
      border:1px solid var(--border); border-radius:16px; padding:14px;
    }
    .btn{background:var(--accent); color:#0b121f; border:none; border-radius:12px; padding:12px 18px; font-weight:800; font-size:14px; cursor:pointer}
    .btn.secondary{background:#202743; color:var(--text); border:3px solid #58b873}
    .btn.secondary:hover{border-color:#7bd389}
    .row{display:flex; flex-wrap:wrap; gap:10px; align-items:center}
    .chip{background:#141a2b; border:1px solid var(--border); padding:10px 12px; border-radius:12px; font-weight:800}
    .big{font-size:20px}
    .muted{color:var(--muted)}
    .input{background:#11173c; border:1px solid var(--border); color:var(--text); border-radius:12px; padding:12px 14px; font-size:18px; min-width:120px}
    .tap{display:flex; align-items:center; justify-content:center;
      background:linear-gradient(180deg, #202743 0%, #151a30 100%);
      border:1px solid var(--border); border-radius:16px; min-height:240px; position:relative; overflow:hidden}
    .capy{font-size:76px !important; filter:drop-shadow(0 6px 14px rgba(0,0,0,.4)); transition:.6s ease;}
    .tap:active .capy{transform:scale(0.96)}
    .tap:before{content:""; width:140px; height:140px; border-radius:50%;
      background:radial-gradient(closest-side, rgba(123,179,255,.45), rgba(123,179,255,0));
      position:absolute; animation:pulse .8s ease-out; left:50%; top:50%; transform:translate(-50%,-50%);
    }
    @keyframes pulse { from {transform:translate(-50%,-50%) scale(.3); opacity:.8} to {transform:translate(-50%,-50%) scale(1.2); opacity:0}}

    .shop-item {
      display: flex; align-items: center; justify-content: space-between;
      gap: 12px; padding: 10px; border-radius: 12px; border: 1px solid var(--border); background: #12172a;
    }
    .shop-item + .shop-item { margin-top: 10px; }

    footer { margin-top: 14px; font-size: 12px; color: var(--muted); text-align: center; }

    /* –ú–æ–¥–∞–ª–∫–∏ –∏ —Ç–æ—Å—Ç—ã */
    .modal {
      display:none; position:fixed; top:10%; left:10%; width:80%; max-height:78%;
      background:#1d2333; border:2px solid var(--border); border-radius:16px; padding:20px; z-index:1000; overflow-y:auto; color:var(--text);
    }
    .modal h2{margin-top:0}
    #achievementsModal.modal{z-index:1000}
    #accessoriesModal.modal{z-index:1100}
    #capybarasModal.modal{z-index:1200}
    #promocodeModal.modal{z-index:1300}

    #achievementToast {
      display: none; position: fixed; top: 0; left: 50%; transform: translateX(-50%);
      background: var(--accent2); color: #0b121f; padding: 12px 20px; border-radius: 0 12px 12px 12px; font-weight: 800; z-index: 2000;
    }

    #remainingInfo { margin-top:10px; font-weight:800; color:var(--accent2); text-align:center; }

    .ok{color:var(--ok)}
    .danger{color:var(--danger)}

    /* –ê–∫—Å–µ—Å—Å—É–∞—Ä—ã –Ω–∞ –∫–∞–ø–∏–±–∞—Ä–µ */
    .accessory {
      position: absolute;
      pointer-events: none;
      z-index: 5;
    }
    .glasses-accessory {
      font-size: 30px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -35%);
    }
    .hat-accessory {
      font-size: 40px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -90%);
    }
    .suit-accessory {
      font-size: 80px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      opacity: 0.7;
    }

    /* –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Å–∫–∏–Ω –∏–∑ –ø—Ä–æ–º–æ–∫–æ–¥–∞ */
    .special-skin-accessory {
      position: absolute;
      font-size: 80px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 4;
      filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.7));
    }

    /* –ö–∞–ø–∏–±–∞—Ä—ã */
    .capybara-container {
      position: relative;
      display: inline-block;
    }
    
    /* –°—Ç–∞—Ç—É—Å –∞–∫—Å–µ—Å—Å—É–∞—Ä–æ–≤ */
    .accessory-toggle {
      margin-top: 8px;
      padding: 6px 12px;
      background: #2a3247;
      border-radius: 8px;
      font-size: 12px;
      cursor: pointer;
      display: inline-block;
    }
    .accessory-toggle.active {
      background: var(--accent);
      color: #0b121f;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª–∫–∏ –ø—Ä–æ–º–æ–∫–æ–¥–∞ */
    .promocode-input {
      width: 100%;
      padding: 15px;
      margin: 15px 0;
      background: #11173c;
      border: 2px solid var(--border);
      border-radius: 12px;
      color: var(--text);
      font-size: 16px;
      text-align: center;
      letter-spacing: 1px;
    }
    
    .promocode-input:focus {
      outline: none;
      border-color: var(--accent2);
    }
    
    .promocode-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
      border: none;
      border-radius: 12px;
      color: #0b121f;
      font-weight: 800;
      font-size: 16px;
      cursor: pointer;
      margin-top: 10px;
    }
    
    .promocode-btn:hover {
      background: linear-gradient(90deg, var(--accent2), var(--accent));
    }
    
    .promocode-list {
      margin-top: 20px;
      padding: 15px;
      background: rgba(30, 40, 60, 0.5);
      border-radius: 12px;
    }
    
    .promocode-item {
      padding: 10px;
      margin-bottom: 8px;
      background: #141a2b;
      border-radius: 8px;
      border-left: 4px solid transparent;
    }
    
    .promocode-item.used {
      border-left-color: var(--ok);
      opacity: 0.8;
    }
    
    .promocode-item.available {
      border-left-color: var(--accent2);
    }
    
    .promocode-reward {
      color: var(--accent);
      font-weight: bold;
    }
    
    .promocode-status {
      float: right;
      font-size: 12px;
      padding: 3px 8px;
      border-radius: 6px;
      background: #202743;
    }
    
    .promocode-status.used {
      background: var(--ok);
      color: #0b121f;
    }
    
    .promocode-status.available {
      background: var(--accent2);
      color: #0b121f;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–µ–π—Å–æ–≤ */
    .cases-container {
      display: none;
      position: relative;
      z-index: 10;
      background-color: transparent;
    }

    .cases-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border);
    }

    .cases-header h1 {
      margin: 0;
      font-size: 28px;
      font-weight: 900;
      letter-spacing: .2px;
    }

    .back-to-menu {
      background: var(--accent2);
      color: #0b121f;
      border: none;
      border-radius: 12px;
      padding: 10px 20px;
      font-weight: 800;
      font-size: 14px;
      cursor: pointer;
    }

    .back-to-menu:hover {
      background: var(--accent);
    }

    .case-item {
      background: linear-gradient(135deg, #1d2333 0%, #151a30 100%);
      border: 2px solid var(--border);
      border-radius: 20px;
      padding: 25px;
      margin-bottom: 25px;
      text-align: center;
      position: relative;
      overflow: hidden;
    }

    .case-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(90deg, var(--accent), var(--accent2));
    }

    .case-icon {
      font-size: 80px;
      margin-bottom: 15px;
      display: block;
    }

    .case-title {
      font-size: 24px;
      font-weight: 900;
      margin-bottom: 10px;
      color: var(--accent);
    }

    .case-price {
      font-size: 20px;
      font-weight: 800;
      margin-bottom: 20px;
      color: var(--accent2);
    }

    .case-chances {
      background: rgba(42, 50, 71, 0.5);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 20px;
      text-align: left;
    }

    .chance-item {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
      padding: 5px 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    }

    .chance-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }

    .chance-percent {
      color: var(--accent);
      font-weight: 800;
    }

    .chance-reward {
      color: var(--accent2);
      font-weight: 800;
    }

    .open-case-btn {
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color: #0b121f;
      border: none;
      border-radius: 12px;
      padding: 15px 30px;
      font-weight: 900;
      font-size: 18px;
      cursor: pointer;
      width: 100%;
      transition: transform 0.2s;
    }

    .open-case-btn:hover {
      transform: scale(1.05);
    }

    .open-case-btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    .case-opening-animation {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(11, 14, 28, 0.95);
      z-index: 3000;
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    .case-result {
      background: linear-gradient(135deg, #1d2333 0%, #151a30 100%);
      border: 3px solid var(--accent);
      border-radius: 20px;
      padding: 40px;
      text-align: center;
      max-width: 500px;
      width: 90%;
      animation: pulse 1.5s infinite;
    }

    .result-icon {
      font-size: 100px;
      margin-bottom: 20px;
      display: block;
      animation: bounce 1s infinite;
    }

    .result-text {
      font-size: 28px;
      font-weight: 900;
      margin-bottom: 15px;
      color: var(--accent);
    }

    .result-amount {
      font-size: 36px;
      font-weight: 900;
      color: var(--accent2);
      margin-bottom: 25px;
    }

    .close-result-btn {
      background: var(--accent);
      color: #0b121f;
      border: none;
      border-radius: 12px;
      padding: 15px 40px;
      font-weight: 900;
      font-size: 18px;
      cursor: pointer;
    }

    .close-result-btn:hover {
      background: var(--accent2);
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }

    /* –ö–Ω–æ–ø–∫–∞ –¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –∫–µ–π—Å—ã */
    #casesBtn {
      background: linear-gradient(135deg, #ff7bd3, #7c5cff);
      color: #0b121f;
      border: none;
      border-radius: 12px;
      padding: 12px 18px;
      font-weight: 800;
      font-size: 14px;
      cursor: pointer;
    }

    #casesBtn:hover {
      background: linear-gradient(135deg, #7c5cff, #ff7bd3);
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–≤—Ç–æ-–º–∞–π–Ω–∏–Ω–≥–∞ */
    .auto-mining-indicator {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: linear-gradient(135deg, var(--accent), var(--accent2));
      color: #0b121f;
      padding: 10px 15px;
      border-radius: 12px;
      font-weight: 800;
      font-size: 12px;
      z-index: 50;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      display: none;
    }
  </style>
</head>
<body>
<div class="snowflakes" id="snowflakes"></div>
<div class="auto-mining-indicator" id="autoMiningIndicator">–ê–í–¢–û-–ú–ê–ô–ù–ò–ù–ì: <span id="miningTimeLeft">0:00</span></div>

<!-- –û—Å–Ω–æ–≤–Ω–æ–π —ç–∫—Ä–∞–Ω -->
<div class="wrap" id="mainScreen">
  <header>
    <div class="row">
      <h1>HTML-bezume Idle Capybara</h1>
      <span class="badge">v3.4</span>
    </div>
    <div class="row">
      <button id="accessoriesBtn" class="btn secondary">üß¢ –ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</button>
      <button id="achievementsBtn" class="btn secondary">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</button>
      <button id="capybarasBtn" class="btn secondary">ü¶´ –ö—É–ø–∏—Ç—å –∫–∞–ø–∏–±–∞—Ä—É</button>
      <button id="promocodeBtn" class="btn secondary">üéÅ –ü—Ä–æ–º–æ–∫–æ–¥</button>
      <button id="casesBtn" class="btn secondary">üéÅ –ö–µ–π—Å—ã</button>
    </div>
  </header>

  <div class="grid2">
    <div class="card">
      <div class="row" style="margin-bottom:10px">
        <span class="chip big">–ë–∞–ª–∞–Ω—Å: <span id="balance">0</span></span>
        <span class="chip">–î–æ—Ö–æ–¥/—Å–µ–∫: <span id="pps">0</span></span>
        <span class="chip">–ö–ª–∏–∫–∏: <span id="clicks">0</span></span>
        <span class="chip">–®–ª—è–ø–∞: <span id="hatChance">0%</span></span>
      </div>
      <div class="tap" id="tapArea">
        <div class="capybara-container">
          <div class="capy" id="capy">ü¶´</div>
          <div id="accessoriesContainer"></div>
          <div id="specialSkinContainer"></div>
        </div>
      </div>
      <div id="remainingInfo">–û—Å—Ç–∞–ª–æ—Å—å –∫–ª–∏–∫–æ–≤: <span id="remainingClicks">1500</span></div>
      <div id="accessoryToggleContainer" style="margin-top: 10px; display: none;">
        <span class="accessory-toggle" data-type="glasses">–û—á–∫–∏ üòé</span>
        <span class="accessory-toggle" data-type="suit">–ö–æ—Å—Ç—é–º üëî</span>
        <span class="accessory-toggle" data-type="special">–ó–æ–ª–æ—Ç–æ–π —Å–∫–∏–Ω ‚ú®</span>
      </div>
      <div class="row" style="margin-top:12px">
        <button id="saveBtn" class="btn secondary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–∞ —Å–µ—Ä–≤–µ—Ä</button>
        <button id="loadBtn" class="btn secondary">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–∞</button>
      </div>
      <p class="muted" id="hint" style="margin-top:8px">ü¶´ –ñ–º–∏ –Ω–∞ –∫–∞–ø–∏–±–∞—Ä—É ‚Äî –ø–æ–ª—É—á–∞–π –æ—á–∫–∏. –ü–æ–∫—É–ø–∞–π –∞–ø–≥—Ä–µ–π–¥—ã ‚Äî –∫–∞–ø–∏–±–∞—Ä–∞ —Ñ–∞—Ä–º–∏—Ç —Å–∞–º–∞ 30 –º–∏–Ω—É—Ç –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞.</p>
    </div>

    <div class="card">
      <div class="row" style="margin-bottom:10px">
        <span class="chip">–ö–ª–∏–∫: <span id="perClick">1</span></span>
        <span class="chip">–ê–≤—Ç–æ: <span id="perSec">0</span>/—Å–µ–∫</span>
        <span class="chip">–û—Ñ—Ñ–ª–∞–π–Ω: <span id="offlineTime">0</span> —Å–µ–∫</span>
      </div>
    </div>

    <div id="shop" class="card">
      <!-- –ë–∞–∑–æ–≤—ã–µ –∞–ø–≥—Ä–µ–π–¥—ã (–û–ß–ï–ù–¨ –¥–æ—Ä–æ–≥–∏–µ) -->
      <div class="shop-item">
        <div class="meta"><div class="title">–ü–∞–ª–æ—á–∫–∞ —É–¥–∞—á–∏ ‚ú®</div><div class="desc">+1 –∫ –¥–æ—Ö–æ–¥—É –∑–∞ –∫–ª–∏–∫.</div></div>
        <div class="act"><span class="price" id="priceClick">–¶–µ–Ω–∞: 100</span><button class="btn" id="buyClick">–ö—É–ø–∏—Ç—å</button></div>
      </div>

      <!-- –ê–≤—Ç–æ-–∞–ø–≥—Ä–µ–π–¥—ã (–û–ß–ï–ù–¨ –¥–æ—Ä–æ–≥–∏–µ, –¥–æ—Ö–æ–¥ –º–∞–ª–µ–Ω—å–∫–∏–π) -->
      <div class="shop-item">
        <div class="meta"><div class="title">–ú–∞–ª–µ–Ω—å–∫–∞—è —Ñ–µ—Ä–º–∞ üåø</div><div class="desc">+0.5 –æ—á–∫–æ–≤/—Å–µ–∫.</div></div>
        <div class="act"><span class="price" id="priceAuto1">–¶–µ–Ω–∞: 500</span><button class="btn" id="buyAuto1">–ö—É–ø–∏—Ç—å</button></div>
      </div>

      <div class="shop-item">
        <div class="meta"><div class="title">–ë–æ–ª—å—à–∞—è —Ñ–µ—Ä–º–∞ üè°</div><div class="desc">+3 –æ—á–∫–∞/—Å–µ–∫.</div></div>
        <div class="act"><span class="price" id="priceAuto2">–¶–µ–Ω–∞: 5 000</span><button class="btn" id="buyAuto2">–ö—É–ø–∏—Ç—å</button></div>
      </div>

      <div class="shop-item">
        <div class="meta"><div class="title">–°—Ä–µ–¥–Ω—è—è —Ñ–µ—Ä–º–∞ üåæ</div><div class="desc">+15 –æ—á–∫–æ–≤/—Å–µ–∫.</div></div>
        <div class="act"><span class="price" id="priceAuto3">–¶–µ–Ω–∞: 50 000</span><button class="btn" id="buyAuto3">–ö—É–ø–∏—Ç—å</button></div>
      </div>

      <div class="shop-item">
        <div class="meta"><div class="title">–†–∞–Ω—á–æ üêÆ</div><div class="desc">+60 –æ—á–∫–æ–≤/—Å–µ–∫.</div></div>
        <div class="act"><span class="price" id="priceAuto4">–¶–µ–Ω–∞: 250 000</span><button class="btn" id="buyAuto4">–ö—É–ø–∏—Ç—å</button></div>
      </div>

      <div class="shop-item">
        <div class="meta"><div class="title">–ó–∞–≤–æ–¥ ‚ùÑÔ∏è</div><div class="desc">+300 –æ—á–∫–æ–≤/—Å–µ–∫.</div></div>
        <div class="act"><span class="price" id="priceAuto5">–¶–µ–Ω–∞: 1 500 000</span><button class="btn" id="buyAuto5">–ö—É–ø–∏—Ç—å</button></div>
      </div>

      <div class="shop-item">
        <div class="meta"><div class="title">–ì–æ—Ä–æ–¥ üèôÔ∏è</div><div class="desc">+1 500 –æ—á–∫–æ–≤/—Å–µ–∫.</div></div>
        <div class="act"><span class="price" id="priceAuto6">–¶–µ–Ω–∞: 7 500 000</span><button class="btn" id="buyAuto6">–ö—É–ø–∏—Ç—å</button></div>
      </div>
      <div class="shop-item">
        <div class="meta"><div class="title">–ú–µ–≥–∞–ø–æ–ª–∏—Å üèôÔ∏è</div><div class="desc">+7 500 –æ—á–∫–æ–≤/—Å–µ–∫.</div></div>
        <div class="act"><span class="price" id="priceAuto7">–¶–µ–Ω–∞: 50 000 000</span><button class="btn" id="buyAuto7">–ö—É–ø–∏—Ç—å</button></div>
      </div>
      <div class="shop-item">
        <div class="meta"><div class="title">–ò–º–ø–µ—Ä–∏—è üåü</div><div class="desc">+30 000 –æ—á–∫–æ–≤/—Å–µ–∫.</div></div>
        <div class="act"><span class="price" id="priceAuto8">–¶–µ–Ω–∞: 300 000 000</span><button class="btn" id="buyAuto8">–ö—É–ø–∏—Ç—å</button></div>
      </div>
      <div class="shop-item">
        <div class="meta"><div class="title">–ì–∞–ª–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ñ–µ—Ä–º–∞ üöÄ</div><div class="desc">+150 000 –æ—á–∫–æ–≤/—Å–µ–∫.</div></div>
        <div class="act"><span class="price" id="priceAuto9">–¶–µ–Ω–∞: 2 000 000 000</span><button class="btn" id="buyAuto9">–ö—É–ø–∏—Ç—å</button></div>
      </div>
      <div class="shop-item">
        <div class="meta"><div class="title">–ú–µ–∂–º–∏—Ä–Ω–∞—è —Ñ–µ—Ä–º–∞ üéØ</div><div class="desc">+600 000 –æ—á–∫–æ–≤/—Å–µ–∫.</div></div>
        <div class="act"><span class="price" id="priceAuto10">–¶–µ–Ω–∞: 10 000 000 000</span><button class="btn" id="buyAuto10">–ö—É–ø–∏—Ç—å</button></div>
      </div>

      <!-- –ú–Ω–æ–∂–∏—Ç–µ–ª—å: –ú–∏—Ñ–∏—á–µ—Å–∫–∞—è –∫–∞–ø–∏–±–∞—Ä–∞ (–û–ß–ï–ù–¨ –¥–æ—Ä–æ–≥–æ–π) -->
      <div class="shop-item">
        <div class="meta"><div class="title">–ú–∏—Ñ–∏—á–µ—Å–∫–∞—è –∫–∞–ø–∏–±–∞—Ä–∞ ‚ú®</div><div class="desc">–ú–Ω–æ–∂–∏—Ç–µ–ª—å –¥–æ—Ö–æ–¥–∞ √ó1.05 (–≤–º–µ—Å—Ç–æ √ó1.1).</div></div>
        <div class="act"><span class="price" id="priceMultMyth">–¶–µ–Ω–∞: 1 000 000 000</span><button class="btn" id="buyMultMyth">–ö—É–ø–∏—Ç—å</button></div>
      </div>
    </div>

    <footer>–ù–µ–æ–Ω–æ–≤—ã–π —Ñ–æ–Ω —Å –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å–Ω–µ–∂–∏–Ω–∫–∞–º–∏, —á–∏—Å—Ç—ã–π HTML/CSS/JS, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ Supabase.</footer>
  </div>
</div>

<!-- –≠–∫—Ä–∞–Ω –∫–µ–π—Å–æ–≤ -->
<div class="cases-container" id="casesScreen">
  <div class="cases-header">
    <h1>üéÅ –ö–ï–ô–°–´</h1>
    <button class="back-to-menu" id="backToMenuBtn">–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é</button>
  </div>

  <div class="case-item">
    <span class="case-icon">‚≠ê</span>
    <div class="case-title">–ö–µ–π—Å –∑–∞ –æ—á–∫–∏</div>
    <div class="case-price">–°—Ç–æ–∏–º–æ—Å—Ç—å: 50,000 –æ—á–∫–æ–≤</div>
    
    <div class="case-chances">
      <div class="chance-item">
        <span class="chance-percent">70% —à–∞–Ω—Å:</span>
        <span class="chance-reward">25,000 –æ—á–∫–æ–≤</span>
      </div>
      <div class="chance-item">
        <span class="chance-percent">15% —à–∞–Ω—Å:</span>
        <span class="chance-reward">75,000 –æ—á–∫–æ–≤</span>
      </div>
      <div class="chance-item">
        <span class="chance-percent">10% —à–∞–Ω—Å:</span>
        <span class="chance-reward">100,000 –æ—á–∫–æ–≤</span>
      </div>
      <div class="chance-item">
        <span class="chance-percent">5% —à–∞–Ω—Å:</span>
        <span class="chance-reward">150,000 –æ—á–∫–æ–≤</span>
      </div>
    </div>

    <button class="open-case-btn" id="openCaseBtn" disabled>–û—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å</button>
  </div>

  <footer style="margin-top: 30px;">–û—Ç–∫—Ä—ã–≤–∞–π—Ç–µ –∫–µ–π—Å—ã –∏ –ø–æ–ª—É—á–∞–π—Ç–µ –±–æ–ª—å—à–∏–µ –Ω–∞–≥—Ä–∞–¥—ã!</footer>
</div>

<!-- –ê–Ω–∏–º–∞—Ü–∏—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞ -->
<div class="case-opening-animation" id="caseOpeningAnimation">
  <div class="case-result" id="caseResult">
    <span class="result-icon" id="resultIcon">üéÅ</span>
    <div class="result-text" id="resultText">–ü–û–ó–î–†–ê–í–õ–Ø–ï–ú!</div>
    <div class="result-amount" id="resultAmount">0 –æ—á–∫–æ–≤</div>
    <button class="close-result-btn" id="closeResultBtn">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>
</div>

<!-- –û—Å—Ç–∞–ª—å–Ω—ã–µ –º–æ–¥–∞–ª–∫–∏ -->
<div id="achievementsModal" class="modal">
    <h2>–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h2>
    <ul id="achievementsList"></ul>
    <button class="btn secondary" onclick="closeAchievements()">–ó–∞–∫—Ä—ã—Ç—å</button>
  </div>

  <div id="accessoriesModal" class="modal">
    <h2>–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</h2>
    <div class="shop-item">
      <div class="meta"><div class="title">–ú–æ–¥–Ω—ã–µ –æ—á–∫–∏ üòé</div><div class="desc">–ö–∞–∂–¥—ã–µ 30 —Å–µ–∫ –¥–∞—é—Ç +3 –æ—á–∫–∞. –ú–æ–∂–Ω–æ –≤–∫–ª—é—á–∞—Ç—å/–≤—ã–∫–ª—é—á–∞—Ç—å.</div></div>
      <div class="act"><span class="price" id="priceSkinGlasses">–¶–µ–Ω–∞: 2 000</span><button class="btn" id="buySkinGlasses">–ö—É–ø–∏—Ç—å</button></div>
    </div>
    <div class="shop-item">
      <div class="meta"><div class="title">–£—à–∞–Ω–∫–∞ üß¢</div><div class="desc">+5% —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –ª–∏–º–∏—Ç–∞.</div></div>
      <div class="act"><span class="price" id="priceSkinUshanka">–¶–µ–Ω–∞: 500 000</span><button class="btn" id="buySkinUshanka">–ö—É–ø–∏—Ç—å</button></div>
    </div>
    <div class="shop-item">
      <div class="meta"><div class="title">–®–ª—è–ø–∞ üé©</div><div class="desc">4% —à–∞–Ω—Å –Ω–∞ x2 –¥–æ—Ö–æ–¥ –∑–∞ –∫–ª–∏–∫.</div></div>
      <div class="act"><span class="price" id="priceSkinHat">–¶–µ–Ω–∞: 10 000</span><button class="btn" id="buySkinHat">–ö—É–ø–∏—Ç—å</button></div>
    </div>
    <div class="shop-item">
      <div class="meta"><div class="title">–ö–æ—Å—Ç—é–º –∫–∞–ø–∏–±–∞—Ä—ã üëî</div><div class="desc">–£–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç –¥–æ—Ö–æ–¥ √ó1.1 (–≤–º–µ—Å—Ç–æ √ó1.2). –ú–æ–∂–Ω–æ –≤–∫–ª—é—á–∞—Ç—å/–≤—ã–∫–ª—é—á–∞—Ç—å.</div></div>
      <div class="act"><span class="price" id="priceSkinSuit">–¶–µ–Ω–∞: 100 000</span><button class="btn" id="buySkinSuit">–ö—É–ø–∏—Ç—å</button></div>
    </div>
    <div class="row" style="margin-top:12px">
      <button class="btn secondary" onclick="closeAccessories()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <div id="capybarasModal" class="modal">
    <h2>–ö—É–ø–∏—Ç—å –∫–∞–ø–∏–±–∞—Ä—É</h2>
    <div class="shop-item">
      <div class="meta"><div class="title">–û–±—ã—á–Ω–∞—è –∫–∞–ø–∏–±–∞—Ä–∞ ü¶´</div><div class="desc">–ë–∞–∑–æ–≤–∞—è –∫–∞–ø–∏–±–∞—Ä–∞. –£–∂–µ –∫—É–ø–ª–µ–Ω–∞.</div></div>
      <div class="act"><button class="btn" id="selectCapy1">–í—ã–±—Ä–∞—Ç—å</button></div>
    </div>
    <div class="shop-item">
      <div class="meta"><div class="title">–•–æ–º—è–∫-–∫–∞–ø–∏–±–∞—Ä–∞ üêπ</div><div class="desc">–ú–∞–ª–µ–Ω—å–∫–∞—è, –Ω–æ —à—É—Å—Ç—Ä–∞—è! +10% –∫ –¥–æ—Ö–æ–¥—É –∑–∞ –∫–ª–∏–∫.</div></div>
      <div class="act"><span class="price" id="priceCapy2">–¶–µ–Ω–∞: 50 000</span><button class="btn" id="buyCapy2">–ö—É–ø–∏—Ç—å</button></div>
    </div>
    <div class="shop-item">
      <div class="meta"><div class="title">–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∞—è –∫–∞–ø–∏–±–∞—Ä–∞ üëë</div><div class="desc">–†–æ—Å–∫–æ—à–Ω–∞—è –∫–∞–ø–∏–±–∞—Ä–∞! +20% –∫ –∞–≤—Ç–æ-–¥–æ—Ö–æ–¥—É.</div></div>
      <div class="act"><span class="price" id="priceCapy3">–¶–µ–Ω–∞: 200 000</span><button class="btn" id="buyCapy3">–ö—É–ø–∏—Ç—å</button></div>
    </div>
    <div class="shop-item">
      <div class="meta"><div class="title">–ö–∏–±–µ—Ä-–∫–∞–ø–∏–±–∞—Ä–∞ ü§ñ</div><div class="desc">–§—É—Ç—É—Ä–∏—Å—Ç–∏—á–Ω–∞—è –∫–∞–ø–∏–±–∞—Ä–∞! √ó1.5 –∫ –º–Ω–æ–∂–∏—Ç–µ–ª—è–º.</div></div>
      <div class="act"><span class="price" id="priceCapy4">–¶–µ–Ω–∞: 1 000 000</span><button class="btn" id="buyCapy4">–ö—É–ø–∏—Ç—å</button></div>
    </div>
    <div class="row" style="margin-top:12px">
      <button class="btn secondary" onclick="closeCapybaras()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <div id="promocodeModal" class="modal">
    <h2>üéÅ –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞</h2>
    <p>–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –±–æ–Ω—É—Å–æ–≤:</p>
    
    <input type="text" id="promocodeInput" class="promocode-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥..." maxlength="30">
    
    <button id="activatePromocodeBtn" class="promocode-btn">–ê–ö–¢–ò–í–ò–†–û–í–ê–¢–¨ –ü–†–û–ú–û–ö–û–î</button>
    
    <div class="promocode-list">
      <h3>–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–æ–º–æ–∫–æ–¥—ã:</h3>
      
      <div class="promocode-item available">
        <strong>BONUS</strong> - <span class="promocode-reward">+100 –º–æ–Ω–µ—Ç</span>
        <span class="promocode-status available">–î–û–°–¢–£–ü–ï–ù</span>
        <div style="font-size:12px; color:var(--muted); margin-top:5px;">–û–¥–Ω–æ—Ä–∞–∑–æ–≤—ã–π –ø—Ä–æ–º–æ–∫–æ–¥ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∏–≥—Ä–æ–∫–∞</div>
      </div>
    </div>
    
    <div id="promocodeResult" style="margin-top:15px; padding:10px; border-radius:8px; display:none;"></div>
    
    <div class="row" style="margin-top:12px">
      <button class="btn secondary" onclick="closePromocode()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
  </div>

  <div id="achievementToast"></div>

  <script>
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Supabase
    const SUPABASE_URL = 'https://eluotpexvyczqiwctsvc.supabase.co';
    const SUPABASE_ANON_KEY = 'sb_publishable_duxB0SIVsm10jO4Q7iX7FA__CcJ_Gsi';
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase –∫–ª–∏–µ–Ω—Ç–∞
    let supabaseClient = null;
    let currentUserId = null;
    let isLoading = false;
    let lastLoadTime = 0;
    const LOAD_COOLDOWN = 30000; // 30 —Å–µ–∫—É–Ω–¥ –∫—É–ª–¥–∞—É–Ω –º–µ–∂–¥—É –∑–∞–≥—Ä—É–∑–∫–∞–º–∏

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase
    function initSupabase() {
      if (typeof supabase === 'undefined') {
        console.error('Supabase –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω. –î–æ–±–∞–≤—å—Ç–µ —Ç–µ–≥ —Å–∫—Ä–∏–ø—Ç–∞ –≤ HTML.');
        return null;
      }
      
      supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
      return supabaseClient;
    }

    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    function getUserId() {
      let userId = localStorage.getItem('capybara_user_id');
      if (!userId) {
        userId = 'user_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now().toString(36);
        localStorage.setItem('capybara_user_id', userId);
      }
      return userId;
    }

    // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ –Ω–∞ Supabase
    async function saveToSupabase() {
      if (!supabaseClient || !currentUserId) return false;
      
      try {
        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        state.lastSaveTime = Date.now();
        
        const saveData = {
          user_id: currentUserId,
          game_state: JSON.stringify(state),
          achievements: JSON.stringify(unlocked),
          last_save: new Date().toISOString(),
          balance: state.balance,
          total_clicks: state.totalClicks
        };
        
        const { data, error } = await supabaseClient
          .from('capybara_saves')
          .upsert({
            ...saveData,
            updated_at: new Date().toISOString()
          }, {
            onConflict: 'user_id'
          });
        
        if (error) {
          console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ Supabase:', error);
          return false;
        }
        
        console.log('–ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ Supabase');
        return true;
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –≤ saveToSupabase:', error);
        return false;
      }
    }

    // –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Å Supabase
    async function loadFromSupabase() {
      if (!supabaseClient || !currentUserId) return false;
      
      try {
        const { data, error } = await supabaseClient
          .from('capybara_saves')
          .select('*')
          .eq('user_id', currentUserId)
          .single();
        
        if (error) {
          console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ Supabase:', error);
          return false;
        }
        
        if (data && data.game_state) {
          const savedState = JSON.parse(data.game_state);
          const savedAchievements = JSON.parse(data.achievements || '[]');
          
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ
          const tempState = { ...state };
          
          // –ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–º–µ–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–º, –ù–ï —Å–æ—Ö—Ä–∞–Ω—è–µ–º –±–∞–ª–∞–Ω—Å –∏ –∫–ª–∏–∫–∏
          Object.keys(savedState).forEach(key => {
            if (key !== 'balance' && key !== 'totalClicks' && key !== 'remainingClicks') {
              state[key] = savedState[key];
            }
          });
          
          // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
          if (data.last_save) {
            state.lastSaveTime = new Date(data.last_save).getTime();
          } else {
            state.lastSaveTime = Date.now();
          }
          
          // –û–±–Ω–æ–≤–ª—è–µ–º unlocked –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
          unlocked = savedAchievements;
          
          console.log('–ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∂–µ–Ω –∏–∑ Supabase');
          return true;
        }
        
        return false;
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –≤ loadFromSupabase:', error);
        return false;
      }
    }

    // –°–æ–∑–¥–∞–µ–º –∞–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–Ω–µ–∂–∏–Ω–∫–∏
    function createSnowflakes() {
      const container = document.getElementById('snowflakes');
      const snowflakeCount = 60;
      
      for (let i = 0; i < snowflakeCount; i++) {
        const snowflake = document.createElement('div');
        snowflake.classList.add('snowflake');
        
        const size = Math.random() * 5 + 2;
        const left = Math.random() * 100;
        const duration = Math.random() * 10 + 10;
        const delay = Math.random() * 5;
        const opacity = Math.random() * 0.6 + 0.3;
        
        snowflake.style.width = `${size}px`;
        snowflake.style.height = `${size}px`;
        snowflake.style.left = `${left}%`;
        snowflake.style.animationDuration = `${duration}s`;
        snowflake.style.animationDelay = `${delay}s`;
        snowflake.style.opacity = opacity;
        snowflake.style.background = `rgba(255, 255, 255, ${opacity})`;
        
        container.appendChild(snowflake);
      }
    }

    // –£–±–µ–¥–∏–º—Å—è —á—Ç–æ —Ñ–æ–Ω —á—ë—Ä–Ω—ã–π
    document.addEventListener('DOMContentLoaded', function() {
      document.body.style.backgroundColor = '#0b0e1c';
      document.documentElement.style.backgroundColor = '#0b0e1c';
      document.body.style.color = '#eef2f7';
    });

    const state = {
      balance: 0,
      perClickBase: 1,
      perSecBase: 0,
      clickUpgrades: 0,
      auto1: 0, auto2: 0, auto3: 0, auto4: 0, auto5: 0,
      auto6: 0, auto7: 0, auto8: 0, auto9: 0, auto10: 0,

      multCount: 0,
      mythBought: false,

      remainingClicks: 1500,
      maxClicks: 1500,
      regenRate: 1,

      totalClicks: 0,

      accessoriesOwned: {glasses:false, ushanka:false, hat:false, suit:false, special:false},
      accessoriesActive: {glasses:false, suit:false, special:false},
      accessoriesTimers: {glasses:null},

      capybarasOwned: {capy1:true, capy2:false, capy3:false, capy4:false},
      currentCapybara: 'capy1',

      promocodesUsed: [],
      specialPromoActivations: 0,

      lastExit: Date.now(),
      lastSaveTime: Date.now(),
      autosaveSec: 30,
      offlineMiningTime: 0,
      
      totalCasesOpened: 0,
    };

    const capybaraEmojis = {
      capy1: 'ü¶´',
      capy2: 'üêπ',
      capy3: 'üëë',
      capy4: 'ü§ñ'
    };

    const capybaraNames = {
      capy1: '–û–±—ã—á–Ω–∞—è –∫–∞–ø–∏–±–∞—Ä–∞',
      capy2: '–•–æ–º—è–∫-–∫–∞–ø–∏–±–∞—Ä–∞',
      capy3: '–ö–æ—Ä–æ–ª–µ–≤—Å–∫–∞—è –∫–∞–ø–∏–±–∞—Ä–∞',
      capy4: '–ö–∏–±–µ—Ä-–∫–∞–ø–∏–±–∞—Ä–∞'
    };

    const el = {
      balance: document.getElementById('balance'),
      pps: document.getElementById('pps'),
      clicks: document.getElementById('clicks'),
      perClick: document.getElementById('perClick'),
      perSec: document.getElementById('perSec'),
      offlineTime: document.getElementById('offlineTime'),
      hatChance: document.getElementById('hatChance'),

      priceClick: document.getElementById('priceClick'),
      priceAuto1: document.getElementById('priceAuto1'),
      priceAuto2: document.getElementById('priceAuto2'),
      priceAuto3: document.getElementById('priceAuto3'),
      priceAuto4: document.getElementById('priceAuto4'),
      priceAuto5: document.getElementById('priceAuto5'),
      priceAuto6: document.getElementById('priceAuto6'),
      priceAuto7: document.getElementById('priceAuto7'),
      priceAuto8: document.getElementById('priceAuto8'),
      priceAuto9: document.getElementById('priceAuto9'),
      priceAuto10: document.getElementById('priceAuto10'),

      priceMultMyth: document.getElementById('priceMultMyth'),

      priceSkinGlasses: document.getElementById('priceSkinGlasses'),
      priceSkinUshanka: document.getElementById('priceSkinUshanka'),
      priceSkinHat: document.getElementById('priceSkinHat'),
      priceSkinSuit: document.getElementById('priceSkinSuit'),

      priceCapy2: document.getElementById('priceCapy2'),
      priceCapy3: document.getElementById('priceCapy3'),
      priceCapy4: document.getElementById('priceCapy4'),

      tapArea: document.getElementById('tapArea'),
      saveBtn: document.getElementById('saveBtn'),
      loadBtn: document.getElementById('loadBtn'),
      achievementsModal: document.getElementById('achievementsModal'),
      accessoriesModal: document.getElementById('accessoriesModal'),
      capybarasModal: document.getElementById('capybarasModal'),
      promocodeModal: document.getElementById('promocodeModal'),
      achievementsBtn: document.getElementById('achievementsBtn'),
      accessoriesBtn: document.getElementById('accessoriesBtn'),
      capybarasBtn: document.getElementById('capybarasBtn'),
      promocodeBtn: document.getElementById('promocodeBtn'),
      remainingClicks: document.getElementById('remainingClicks'),
      capy: document.getElementById('capy'),
      accessoriesContainer: document.getElementById('accessoriesContainer'),
      specialSkinContainer: document.getElementById('specialSkinContainer'),
      accessoryToggleContainer: document.getElementById('accessoryToggleContainer'),
      promocodeInput: document.getElementById('promocodeInput'),
      activatePromocodeBtn: document.getElementById('activatePromocodeBtn'),
      promocodeResult: document.getElementById('promocodeResult'),
      toast: document.getElementById('achievementToast'),
      
      // –ù–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –∫–µ–π—Å–æ–≤
      mainScreen: document.getElementById('mainScreen'),
      casesScreen: document.getElementById('casesScreen'),
      casesBtn: document.getElementById('casesBtn'),
      backToMenuBtn: document.getElementById('backToMenuBtn'),
      openCaseBtn: document.getElementById('openCaseBtn'),
      caseOpeningAnimation: document.getElementById('caseOpeningAnimation'),
      caseResult: document.getElementById('caseResult'),
      resultIcon: document.getElementById('resultIcon'),
      resultText: document.getElementById('resultText'),
      resultAmount: document.getElementById('resultAmount'),
      closeResultBtn: document.getElementById('closeResultBtn'),
      
      // –ê–≤—Ç–æ-–º–∞–π–Ω–∏–Ω–≥ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
      autoMiningIndicator: document.getElementById('autoMiningIndicator'),
      miningTimeLeft: document.getElementById('miningTimeLeft'),
    };

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞
    function updateCaseButton() {
      const canOpenCase = state.balance >= 50000;
      el.openCaseBtn.disabled = !canOpenCase;
      el.openCaseBtn.textContent = canOpenCase ? '–û—Ç–∫—Ä—ã—Ç—å –∫–µ–π—Å –∑–∞ 50,000 –æ—á–∫–æ–≤' : '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ (–Ω—É–∂–Ω–æ 50,000)';
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞
    function openCase() {
      if (state.balance < 50000) {
        showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞!');
        return;
      }

      // –°–Ω–∏–º–∞–µ–º —Å—Ç–æ–∏–º–æ—Å—Ç—å –∫–µ–π—Å–∞
      state.balance -= 50000;
      state.totalCasesOpened = (state.totalCasesOpened || 0) + 1;
      
      // –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å–ª—É—á–∞–π–Ω—É—é –Ω–∞–≥—Ä–∞–¥—É –ø–æ —É–∫–∞–∑–∞–Ω–Ω—ã–º —à–∞–Ω—Å–∞–º
      const random = Math.random() * 100;
      let reward = 0;
      let icon = '‚≠ê';
      
      if (random < 70) {
        // 70% —à–∞–Ω—Å - 25,000 –æ—á–∫–æ–≤
        reward = 25000;
        icon = 'üí∞';
      } else if (random < 85) {
        // 15% —à–∞–Ω—Å - 75,000 –æ—á–∫–æ–≤
        reward = 75000;
        icon = 'üíé';
      } else if (random < 95) {
        // 10% —à–∞–Ω—Å - 100,000 –æ—á–∫–æ–≤
        reward = 100000;
        icon = 'üíé';
      } else {
        // 5% —à–∞–Ω—Å - 150,000 –æ—á–∫–æ–≤
        reward = 150000;
        icon = 'üíé';
      }
      
      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞–≥—Ä–∞–¥—É
      state.balance += reward;
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é –æ—Ç–∫—Ä—ã—Ç–∏—è
      showCaseOpeningAnimation(reward, icon);
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏ –æ–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
      save();
      render();
      updateCaseButton();
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
      checkAchievements();
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ –∞–Ω–∏–º–∞—Ü–∏–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞
    function showCaseOpeningAnimation(reward, icon) {
      el.resultIcon.textContent = icon;
      el.resultAmount.textContent = `${reward.toLocaleString('ru-RU')} –æ—á–∫–æ–≤`;
      
      // –†–∞–∑–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –Ω–∞–≥—Ä–∞–¥—ã
      if (reward >= 150000) {
        el.resultText.textContent = '–î–ñ–ï–ö–ü–û–¢!';
      } else if (reward >= 100000) {
        el.resultText.textContent = '–û–¢–õ–ò–ß–ù–ê–Ø –£–î–ê–ß–ê!';
      } else if (reward >= 75000) {
        el.resultText.textContent = '–û–ß–ï–ù–¨ –•–û–†–û–®–û!';
      } else {
        el.resultText.textContent = '–ü–û–ó–î–†–ê–í–õ–Ø–ï–ú!';
      }
      
      el.caseOpeningAnimation.style.display = 'flex';
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏ –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–µ–π—Å–∞
    function hideCaseOpeningAnimation() {
      el.caseOpeningAnimation.style.display = 'none';
    }

    // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏
    function showCasesScreen() {
      el.mainScreen.style.display = 'none';
      el.casesScreen.style.display = 'block';
      updateCaseButton();
    }

    function showMainScreen() {
      el.mainScreen.style.display = 'block';
      el.casesScreen.style.display = 'none';
    }

    function getPrices(){
      return {
        click: Math.floor(100 * Math.pow(1.35, state.clickUpgrades)),

        auto1: Math.floor(500 * Math.pow(1.3, state.auto1)),
        auto2: Math.floor(5000 * Math.pow(1.28, state.auto2)),
        auto3: Math.floor(50000 * Math.pow(1.26, state.auto3)),
        auto4: Math.floor(250000 * Math.pow(1.26, state.auto4)),
        auto5: Math.floor(1500000 * Math.pow(1.24, state.auto5)),
        auto6: Math.floor(7500000 * Math.pow(1.24, state.auto6)),
        auto7: Math.floor(50000000 * Math.pow(1.22, state.auto7)),
        auto8: Math.floor(300000000 * Math.pow(1.22, state.auto8)),
        auto9: Math.floor(2000000000 * Math.pow(1.2, state.auto9)),
        auto10: Math.floor(10000000000 * Math.pow(1.2, state.auto10)),

        multMyth: Math.floor(1000000000 * Math.pow(1.5, state.multCount)),

        skinGlasses: 2000,
        skinUshanka: 500000,
        skinHat: 10000,
        skinSuit: 100000,

        capy2: 50000,
        capy3: 200000,
        capy4: 1000000
      };
    }

    function getMultiplier(){
      const suitMul = state.accessoriesOwned.suit && state.accessoriesActive.suit ? 1.1 : 1.0;
      const specialMul = state.accessoriesOwned.special && state.accessoriesActive.special ? 1.15 : 1.0;
      const capybaraBonus = getCapybaraBonus();
      return Math.pow(1.05, state.multCount) * suitMul * specialMul * capybaraBonus;
    }

    function getCapybaraBonus() {
      switch(state.currentCapybara) {
        case 'capy1': return 1.0;
        case 'capy2': return 1.1;
        case 'capy3': return 1.2;
        case 'capy4': return 1.5;
        default: return 1.0;
      }
    }

    function incomePerClick(){
      const base = (state.perClickBase + state.clickUpgrades);
      const capybaraEffect = state.currentCapybara === 'capy2' ? 1.1 : 1.0;
      
      return Math.floor(base * capybaraEffect * getMultiplier());
    }

    function incomePerSec(){
      const autoGain =
        state.auto1 * 0.5 +
        state.auto2 * 3 +
        state.auto3 * 15 +
        state.auto4 * 60 +
        state.auto5 * 300 +
        state.auto6 * 1500 +
        state.auto7 * 7500 +
        state.auto8 * 30000 +
        state.auto9 * 150000 +
        state.auto10 * 600000;
      
      const capybaraEffect = state.currentCapybara === 'capy3' ? 1.2 : 1.0;
      
      return Math.floor((state.perSecBase + autoGain) * capybaraEffect * getMultiplier());
    }

    function render(){
      el.balance.textContent = state.balance.toLocaleString('ru-RU');
      el.clicks.textContent = state.totalClicks.toLocaleString('ru-RU');
      el.perClick.textContent = incomePerClick().toLocaleString('ru-RU');
      el.perSec.textContent = incomePerSec().toLocaleString('ru-RU');
      el.pps.textContent = incomePerSec().toLocaleString('ru-RU');
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ—Å—Ç–∞–≤—à–µ–µ—Å—è –≤—Ä–µ–º—è –∞–≤—Ç–æ-–º–∞–π–Ω–∏–Ω–≥–∞
      const remainingTime = Math.max(0, 1800 - state.offlineMiningTime);
      const minutes = Math.floor(remainingTime / 60);
      const seconds = remainingTime % 60;
      el.offlineTime.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
      
      // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —à–∞–Ω—Å –¥–ª—è —à–ª—è–ø—ã
      const hatChance = state.accessoriesOwned.hat ? '4%' : '0%';
      el.hatChance.textContent = hatChance;

      el.capy.textContent = capybaraEmojis[state.currentCapybara];

      const p = getPrices();
      if(el.priceClick) el.priceClick.textContent = '–¶–µ–Ω–∞: ' + p.click.toLocaleString('ru-RU');
      el.priceAuto1.textContent = '–¶–µ–Ω–∞: ' + p.auto1.toLocaleString('ru-RU');
      el.priceAuto2.textContent = '–¶–µ–Ω–∞: ' + p.auto2.toLocaleString('ru-RU');
      el.priceAuto3.textContent = '–¶–µ–Ω–∞: ' + p.auto3.toLocaleString('ru-RU');
      el.priceAuto4.textContent = '–¶–µ–Ω–∞: ' + p.auto4.toLocaleString('ru-RU');
      el.priceAuto5.textContent = '–¶–µ–Ω–∞: ' + p.auto5.toLocaleString('ru-RU');
      el.priceAuto6.textContent = '–¶–µ–Ω–∞: ' + p.auto6.toLocaleString('ru-RU');
      el.priceAuto7.textContent = '–¶–µ–Ω–∞: ' + p.auto7.toLocaleString('ru-RU');
      el.priceAuto8.textContent = '–¶–µ–Ω–∞: ' + p.auto8.toLocaleString('ru-RU');
      el.priceAuto9.textContent = '–¶–µ–Ω–∞: ' + p.auto9.toLocaleString('ru-RU');
      el.priceAuto10.textContent = '–¶–µ–Ω–∞: ' + p.auto10.toLocaleString('ru-RU');

      el.priceMultMyth.textContent = '–¶–µ–Ω–∞: ' + p.multMyth.toLocaleString('ru-RU');

      el.priceSkinGlasses.textContent = '–¶–µ–Ω–∞: ' + p.skinGlasses.toLocaleString('ru-RU');
      el.priceSkinUshanka.textContent = '–¶–µ–Ω–∞: ' + p.skinUshanka.toLocaleString('ru-RU');
      el.priceSkinHat.textContent = '–¶–µ–Ω–∞: ' + p.skinHat.toLocaleString('ru-RU');
      el.priceSkinSuit.textContent = '–¶–µ–Ω–∞: ' + p.skinSuit.toLocaleString('ru-RU');

      el.priceCapy2.textContent = '–¶–µ–Ω–∞: ' + p.capy2.toLocaleString('ru-RU');
      el.priceCapy3.textContent = '–¶–µ–Ω–∞: ' + p.capy3.toLocaleString('ru-RU');
      el.priceCapy4.textContent = '–¶–µ–Ω–∞: ' + p.capy4.toLocaleString('ru-RU');

      state.maxClicks = 1500;
      el.remainingClicks.textContent = state.remainingClicks.toLocaleString('ru-RU');

      updateAccessoriesDisplay();
      updateAccessoryToggles();
      checkAchievements();
      updateCaseButton();
    }

    function updateAccessoriesDisplay() {
      el.accessoriesContainer.innerHTML = '';
      el.specialSkinContainer.innerHTML = '';
      
      if (state.accessoriesOwned.glasses && state.accessoriesActive.glasses) {
        const glasses = document.createElement('div');
        glasses.className = 'accessory glasses-accessory';
        glasses.textContent = 'üòé';
        el.accessoriesContainer.appendChild(glasses);
      }
      
      if (state.accessoriesOwned.suit && state.accessoriesActive.suit) {
        const suit = document.createElement('div');
        suit.className = 'accessory suit-accessory';
        suit.textContent = 'üëî';
        el.accessoriesContainer.appendChild(suit);
      }
      
      if (state.accessoriesOwned.special && state.accessoriesActive.special) {
        const special = document.createElement('div');
        special.className = 'accessory special-skin-accessory';
        special.textContent = '‚ú®';
        el.specialSkinContainer.appendChild(special);
      }
    }

    function updateAccessoryToggles() {
      const container = el.accessoryToggleContainer;
      const hasAccessories = state.accessoriesOwned.glasses || state.accessoriesOwned.suit || state.accessoriesOwned.special;
      
      if (hasAccessories) {
        container.style.display = 'block';
        
        const toggles = container.querySelectorAll('.accessory-toggle');
        toggles.forEach(toggle => {
          const type = toggle.dataset.type;
          const isActive = state.accessoriesActive[type];
          const isOwned = state.accessoriesOwned[type];
          
          toggle.style.display = isOwned ? 'inline-block' : 'none';
          
          if (isOwned) {
            let text = '';
            if (type === 'glasses') text = '–û—á–∫–∏ üòé';
            else if (type === 'suit') text = '–ö–æ—Å—Ç—é–º üëî';
            else if (type === 'special') text = '–ó–æ–ª–æ—Ç–æ–π —Å–∫–∏–Ω ‚ú®';
            
            toggle.textContent = `${text}: ${isActive ? '–í–ö–õ' : '–í–´–ö–õ'}`;
            toggle.classList.toggle('active', isActive);
          }
        });
      } else {
        container.style.display = 'none';
      }
    }

    const KEY = 'capy_idle_save_v7';
    function save(){
      const payload = { ...state, lastExit: Date.now() };
      localStorage.setItem(KEY, JSON.stringify(payload));
      
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–∞–∫–∂–µ –≤ Supabase
      if (supabaseClient) {
        saveToSupabase();
      }
    }
    
    function load(){
      const raw = localStorage.getItem(KEY);
      if(!raw) return;
      try{
        const data = JSON.parse(raw);
        Object.assign(state, data);

        if(typeof state.lastExit !== 'number') state.lastExit = Date.now();
        if(typeof state.lastSaveTime !== 'number') state.lastSaveTime = Date.now();
        if(typeof state.maxClicks !== 'number') state.maxClicks = 1500;
        if(typeof state.regenRate !== 'number') state.regenRate = 1;
        if(typeof state.offlineMiningTime !== 'number') state.offlineMiningTime = 0;

        if(!state.accessoriesOwned) state.accessoriesOwned = {glasses:false, ushanka:false, hat:false, suit:false, special:false};
        if(!state.accessoriesActive) state.accessoriesActive = {glasses:false, suit:false, special:false};
        if(!state.accessoriesTimers) state.accessoriesTimers = {glasses:null};

        if(!state.capybarasOwned) state.capybarasOwned = {capy1:true, capy2:false, capy3:false, capy4:false};
        if(!state.currentCapybara) state.currentCapybara = 'capy1';

        if(!state.promocodesUsed) state.promocodesUsed = [];
        if(typeof state.specialPromoActivations !== 'number') state.specialPromoActivations = 0;
        if(typeof state.totalCasesOpened !== 'number') state.totalCasesOpened = 0;

        if(typeof state.mythBought !== 'boolean') state.mythBought = false;
        if(typeof state.totalClicks !== 'number') state.totalClicks = 0;
        if(typeof state.remainingClicks !== 'number') state.remainingClicks = 1500;
      }catch(e){}
    }

    function spawnPulse(x,y){
      const p = document.createElement('div');
      p.className = 'pulse';
      p.style.position='absolute';
      p.style.left = (x - 70) + 'px';
      p.style.top  = (y - 70) + 'px';
      p.style.width='140px'; p.style.height='140px'; p.style.borderRadius='50%';
      p.style.background='radial-gradient(closest-side, rgba(123,179,255,.45), rgba(123,179,255,0))';
      p.style.animation='pulse .8s ease-out';
      el.tapArea.appendChild(p);
      setTimeout(()=>p.remove(), 800);
    }

    function tap(x,y){
      if(state.remainingClicks <= 0) return;
      state.remainingClicks = Math.max(0, state.remainingClicks - 1);
      
      let gain = incomePerClick();
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —à–∞–Ω—Å –¥–ª—è —à–ª—è–ø—ã
      if (state.accessoriesOwned.hat && Math.random() < 0.04) { // 4% —à–∞–Ω—Å
        gain *= 2;
        showToast('üé© –£–î–ê–ß–ê! x2 –¥–æ—Ö–æ–¥ –∑–∞ –∫–ª–∏–∫!');
      }
      
      state.balance += gain;
      state.totalClicks++;
      spawnPulse(x,y);
      render();
    }

    let autoTimer = null;
    function startAuto(){
      if(autoTimer) clearInterval(autoTimer);
      autoTimer = setInterval(()=>{
        state.balance += incomePerSec();
        render();
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –∞–≤—Ç–æ-–º–∞–π–Ω–∏–Ω–≥–∞
        state.offlineMiningTime++;
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä, –µ—Å–ª–∏ –∞–≤—Ç–æ-–º–∞–π–Ω–∏–Ω–≥ –∞–∫—Ç–∏–≤–µ–Ω
        if (state.offlineMiningTime < 1800) {
          const remaining = 1800 - state.offlineMiningTime;
          const minutes = Math.floor(remaining / 60);
          const seconds = remaining % 60;
          el.miningTimeLeft.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
          el.autoMiningIndicator.style.display = 'block';
        } else {
          el.autoMiningIndicator.style.display = 'none';
        }
      }, 1000);
    }

    let autosaveTimer = null;
    function startAutosave(){
      if(autosaveTimer) clearInterval(autosaveTimer);
      autosaveTimer = setInterval(save, Math.max(5, state.autosaveSec || 30) * 1000);
    }

    let regenTimer = null;
    function startRegen(){
      if(regenTimer) clearInterval(regenTimer);
      regenTimer = setInterval(()=>{
        if(state.remainingClicks < state.maxClicks){
          state.remainingClicks = Math.min(state.maxClicks, state.remainingClicks + state.regenRate);
          render();
        }
      }, 1000);
    }

    function startGlassesTimer(){
      if(state.accessoriesTimers.glasses) clearInterval(state.accessoriesTimers.glasses);
      if(!state.accessoriesOwned.glasses || !state.accessoriesActive.glasses) return;
      state.accessoriesTimers.glasses = setInterval(()=>{
        state.balance += 3;
        render();
      }, 30000);
    }

    function restoreOffline(){
      const now = Date.now();
      const lastSave = state.lastSaveTime || state.lastExit || now;
      const diffSec = Math.floor((now - lastSave) / 1000);
      
      if(diffSec <= 0) return;

      // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–ª–∏–∫–∏
      const clicksRestore = diffSec * state.regenRate;
      state.remainingClicks = Math.min(state.maxClicks, state.remainingClicks + clicksRestore);

      // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –¥–æ—Ö–æ–¥ –æ—Ç –æ—á–∫–æ–≤
      if(state.accessoriesOwned.glasses && state.accessoriesActive.glasses){
        const intervals = Math.floor(diffSec / 30);
        if(intervals > 0) state.balance += intervals * 3;
      }
      
      // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∞–≤—Ç–æ-–º–∞–π–Ω–∏–Ω–≥ (–º–∞–∫—Å–∏–º—É–º 30 –º–∏–Ω—É—Ç)
      const maxOfflineTime = 1800;
      const offlineTime = Math.min(diffSec, maxOfflineTime);
      
      if (offlineTime > 0) {
        const incomePerSecond = incomePerSec();
        const offlineIncome = Math.floor(incomePerSecond * offlineTime);
        state.balance += offlineIncome;
        state.offlineMiningTime = Math.min(state.offlineMiningTime + offlineTime, maxOfflineTime);
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –±—ã–ª —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –¥–æ—Ö–æ–¥
        if (offlineIncome > 1000) {
          showToast(`üïí –û—Ñ—Ñ–ª–∞–π–Ω –¥–æ—Ö–æ–¥: +${offlineIncome.toLocaleString('ru-RU')} –∑–∞ ${Math.floor(offlineTime/60)} –º–∏–Ω.`);
        }
      }
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –≤—Ä–µ–º—è –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
      state.lastSaveTime = now;
    }

    function showToast(text){
      el.toast.textContent = text;
      el.toast.style.display='block';
      setTimeout(()=>el.toast.style.display='none', 4000);
    }

    const achievements = [
      {id:'click1000', name:'–ö–ª–∏–∫-–º–∞—Å—Ç–µ—Ä', desc:'–°–¥–µ–ª–∞—Ç—å 1000 –∫–ª–∏–∫–æ–≤', check:()=>state.totalClicks>=1000},
      {id:'balance10000', name:'–§–µ—Ä–º–µ—Ä –∫–∞–ø–∏–±–∞—Ä–∞', desc:'–î–æ—Å—Ç–∏—á—å –±–∞–ª–∞–Ω—Å–∞ 10 000', check:()=>state.balance>=10000},
      {id:'multMyth', name:'–ú–∏—Ñ–∏—á–µ—Å–∫–∞—è –ø–æ–∫—É–ø–∫–∞', desc:'–ö—É–ø–∏—Ç—å ¬´–ú–∏—Ñ–∏—á–µ—Å–∫–∞—è –∫–∞–ø–∏–±–∞—Ä–∞¬ª', check:()=>state.mythBought===true},
      {id:'accModnik', name:'–ú–æ–¥–Ω–∏–∫', desc:'–û—Ç–∫—Ä—ã—Ç—å –ª—é–±–æ–π –∞–∫—Å–µ—Å—Å—É–∞—Ä', check:()=>Object.values(state.accessoriesOwned).some(Boolean)},
      {id:'accAll', name:'–ê–∫—Å–µ—Å—Å—É–∞—Ä–Ω—ã–π –º–∞–≥–Ω–∏—Ç', desc:'–û—Ç–∫—Ä—ã—Ç—å –≤—Å–µ –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã', check:()=>Object.values(state.accessoriesOwned).every(Boolean)},
      {id:'boss', name:'–ö–∞–ø–∏–±–∞—Ä-–±–æ—Å—Å', desc:'–î–æ—Ö–æ–¥ 1 000 000/—Å–µ–∫', check:()=>incomePerSec()>=1000000},
      {id:'capyCollector', name:'–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä –∫–∞–ø–∏–±–∞—Ä', desc:'–ö—É–ø–∏—Ç—å 3 –∫–∞–ø–∏–±–∞—Ä—ã', check:()=>Object.values(state.capybarasOwned).filter(v=>v).length >= 3},
      {id:'promoUser', name:'–ü—Ä–æ–º–æ-–æ—Ö–æ—Ç–Ω–∏–∫', desc:'–ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥', check:()=>state.promocodesUsed.length > 0},
      {id:'specialSkin', name:'–ó–æ–ª–æ—Ç–∞—è –∫–∞–ø–∏–±–∞—Ä–∞', desc:'–ü–æ–ª—É—á–∏—Ç—å –∑–æ–ª–æ—Ç–æ–π —Å–∫–∏–Ω', check:()=>state.accessoriesOwned.special === true},
      {id:'caseOpener', name:'–ò—Å–∫–∞—Ç–µ–ª—å —É–¥–∞—á–∏', desc:'–û—Ç–∫—Ä—ã—Ç—å –ø–µ—Ä–≤—ã–π –∫–µ–π—Å', check:()=>(state.totalCasesOpened || 0) > 0},
    ];

    let unlocked = JSON.parse(localStorage.getItem('capy_achievements') || '[]');

    function checkAchievements(){
      achievements.forEach(a=>{
        if(!unlocked.includes(a.id) && a.check()){
          unlocked.push(a.id);
          localStorage.setItem('capy_achievements', JSON.stringify(unlocked));
          showToast(`üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏–µ: "${a.name}"`);
        }
      });
    }

    function openAchievements(){
      const modal = el.achievementsModal;
      const list = document.getElementById('achievementsList');
      list.innerHTML='';
      
      achievements.forEach(a=>{
        const li = document.createElement('li');
        const done = unlocked.includes(a.id);
        li.textContent = `${a.name} ‚Äî ${a.desc} ${done?'‚úÖ':'‚ùå'}`;
        list.appendChild(li);
      });
      
      modal.style.display='block';
    }
    function closeAchievements(){ el.achievementsModal.style.display='none'; }
    function openAccessories(){ el.accessoriesModal.style.display='block'; }
    function closeAccessories(){ el.accessoriesModal.style.display='none'; }
    function openCapybaras(){ el.capybarasModal.style.display='block'; }
    function closeCapybaras(){ el.capybarasModal.style.display='none'; }
    
    function openPromocode(){
      el.promocodeModal.style.display='block';
      el.promocodeInput.value = '';
      el.promocodeResult.style.display = 'none';
      
      const bonusItem = document.querySelector('.promocode-item');
      const bonusStatus = bonusItem.querySelector('.promocode-status');
      
      if (state.promocodesUsed.includes('BONUS')) {
        bonusItem.classList.remove('available');
        bonusItem.classList.add('used');
        bonusStatus.textContent = '–ò–°–ü–û–õ–¨–ó–û–í–ê–ù';
        bonusStatus.className = 'promocode-status used';
      } else {
        bonusItem.classList.remove('used');
        bonusItem.classList.add('available');
        bonusStatus.textContent = '–î–û–°–¢–£–ü–ï–ù';
        bonusStatus.className = 'promocode-status available';
      }
    }
    
    function closePromocode(){ 
      el.promocodeModal.style.display='none'; 
    }
    
    function activatePromocode() {
      const code = el.promocodeInput.value.trim().toUpperCase();
      
      if (!code) {
        showPromocodeResult('–í–≤–µ–¥–∏—Ç–µ –ø—Ä–æ–º–æ–∫–æ–¥!', 'error');
        return;
      }
      
      if (state.promocodesUsed.includes(code)) {
        showPromocodeResult('–≠—Ç–æ—Ç –ø—Ä–æ–º–æ–∫–æ–¥ —É–∂–µ –±—ã–ª –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω!', 'error');
        return;
      }
      
      if (code === 'BONUS') {
        state.balance += 100;
        state.promocodesUsed.push(code);
        showPromocodeResult('üéâ –ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! –í—ã –ø–æ–ª—É—á–∏–ª–∏ 100 –º–æ–Ω–µ—Ç!', 'success');
        showToast('–ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω! +100 –º–æ–Ω–µ—Ç');
        save();
        render();
        openPromocode();
        
      } else if (code === 'CAPY2026CAPYCAPY666') {
        if (state.specialPromoActivations >= 2) {
          showPromocodeResult('–≠—Ç–æ—Ç –ø—Ä–æ–º–æ–∫–æ–¥ –±–æ–ª—å—à–µ –Ω–µ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω! –õ–∏–º–∏—Ç –∞–∫—Ç–∏–≤–∞—Ü–∏–π –∏—Å—á–µ—Ä–ø–∞–Ω.', 'error');
          return;
        }
        
        state.accessoriesOwned.special = true;
        state.accessoriesActive.special = true;
        state.specialPromoActivations++;
        state.promocodesUsed.push(code);
        
        showPromocodeResult('üéâ –°–ï–ö–†–ï–¢–ù–´–ô –ü–†–û–ú–û–ö–û–î –ê–ö–¢–ò–í–ò–†–û–í–ê–ù! –í—ã –ø–æ–ª—É—á–∏–ª–∏ —ç–∫—Å–∫–ª—é–∑–∏–≤–Ω—ã–π –∑–æ–ª–æ—Ç–æ–π —Å–∫–∏–Ω –∫–∞–ø–∏–±–∞—Ä—ã! ‚ú®', 'success');
        showToast('–ü–æ–ª—É—á–µ–Ω –∑–æ–ª–æ—Ç–æ–π —Å–∫–∏–Ω –∫–∞–ø–∏–±–∞—Ä—ã! ‚ú®');
        save();
        render();
        
      } else {
        showPromocodeResult('–ù–µ–≤–µ—Ä–Ω—ã–π –ø—Ä–æ–º–æ–∫–æ–¥!', 'error');
      }
    }
    
    function showPromocodeResult(message, type) {
      el.promocodeResult.textContent = message;
      el.promocodeResult.style.display = 'block';
      
      if (type === 'success') {
        el.promocodeResult.style.background = 'rgba(88, 184, 115, 0.2)';
        el.promocodeResult.style.border = '2px solid var(--ok)';
        el.promocodeResult.style.color = 'var(--ok)';
      } else {
        el.promocodeResult.style.background = 'rgba(255, 107, 107, 0.2)';
        el.promocodeResult.style.border = '2px solid var(--danger)';
        el.promocodeResult.style.color = 'var(--danger)';
      }
    }

    // –ò–Ω—Ç–µ—Ä–∞–∫—Ü–∏–∏
    el.tapArea.addEventListener('click', (e)=>{
      const rect = el.tapArea.getBoundingClientRect();
      tap(e.clientX - rect.left, e.clientY - rect.top);
    });
    el.tapArea.addEventListener('touchstart', (e)=>{
      const t = e.touches[0];
      const rect = el.tapArea.getBoundingClientRect();
      tap(t.clientX - rect.left, t.clientY - rect.top);
      e.preventDefault();
    }, {passive:false});

    el.accessoryToggleContainer.addEventListener('click', (e)=>{
      if(e.target.classList.contains('accessory-toggle')) {
        const type = e.target.dataset.type;
        if(state.accessoriesOwned[type]) {
          state.accessoriesActive[type] = !state.accessoriesActive[type];
          render();
          save();
          
          if(type === 'glasses') {
            startGlassesTimer();
          }
        }
      }
    });

    el.activatePromocodeBtn.addEventListener('click', activatePromocode);
    
    el.promocodeInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') {
        activatePromocode();
      }
    });

    // –ö–Ω–æ–ø–∫–∏ –ø–æ–∫—É–ø–æ–∫
    document.getElementById('buyClick').addEventListener('click', ()=>tryBuy('click'));
    document.getElementById('buyAuto1').addEventListener('click', ()=>tryBuy('auto1'));
    document.getElementById('buyAuto2').addEventListener('click', ()=>tryBuy('auto2'));
    document.getElementById('buyAuto3').addEventListener('click', ()=>tryBuy('auto3'));
    document.getElementById('buyAuto4').addEventListener('click', ()=>tryBuy('auto4'));
    document.getElementById('buyAuto5').addEventListener('click', ()=>tryBuy('auto5'));
    document.getElementById('buyAuto6').addEventListener('click', ()=>tryBuy('auto6'));
    document.getElementById('buyAuto7').addEventListener('click', ()=>tryBuy('auto7'));
    document.getElementById('buyAuto8').addEventListener('click', ()=>tryBuy('auto8'));
    document.getElementById('buyAuto9').addEventListener('click', ()=>tryBuy('auto9'));
    document.getElementById('buyAuto10').addEventListener('click', ()=>tryBuy('auto10'));

    document.getElementById('buyMultMyth').addEventListener('click', ()=>tryBuy('multMyth'));

    document.getElementById('buySkinGlasses').addEventListener('click', ()=>tryBuy('skinGlasses'));
    document.getElementById('buySkinUshanka').addEventListener('click', ()=>tryBuy('skinUshanka'));
    document.getElementById('buySkinHat').addEventListener('click', ()=>tryBuy('skinHat'));
    document.getElementById('buySkinSuit').addEventListener('click', ()=>tryBuy('skinSuit'));

    document.getElementById('selectCapy1').addEventListener('click', ()=>selectCapybara('capy1'));
    document.getElementById('buyCapy2').addEventListener('click', ()=>tryBuy('capy2'));
    document.getElementById('buyCapy3').addEventListener('click', ()=>tryBuy('capy3'));
    document.getElementById('buyCapy4').addEventListener('click', ()=>tryBuy('capy4'));

    // –ö–Ω–æ–ø–∫–∏ –º–µ–Ω—é
    el.saveBtn.addEventListener('click', async ()=> {
      save(); 
      render();
      const success = await saveToSupabase();
      showToast(success ? '–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ!' : '–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è');
    });
    
    el.loadBtn.addEventListener('click', async ()=> {
      const now = Date.now();
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫—É–ª–¥–∞—É–Ω
      if (isLoading) {
        showToast('–£–∂–µ –∑–∞–≥—Ä—É–∂–∞–µ–º...');
        return;
      }
      
      if (now - lastLoadTime < LOAD_COOLDOWN) {
        const secondsLeft = Math.ceil((LOAD_COOLDOWN - (now - lastLoadTime)) / 1000);
        showToast(`–ü–æ–¥–æ–∂–¥–∏—Ç–µ ${secondsLeft} —Å–µ–∫—É–Ω–¥ –ø–µ—Ä–µ–¥ —Å–ª–µ–¥—É—é—â–µ–π –∑–∞–≥—Ä—É–∑–∫–æ–π`);
        return;
      }
      
      isLoading = true;
      el.loadBtn.disabled = true;
      el.loadBtn.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';
      
      try {
        const success = await loadFromSupabase();
        if (success) {
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏
          lastLoadTime = now;
          
          // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
          render();
          
          // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ
          await saveToSupabase();
          
          showToast('–ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∂–µ–Ω —Å —Å–µ—Ä–≤–µ—Ä–∞!');
        } else {
          showToast('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å');
        }
      } finally {
        isLoading = false;
        el.loadBtn.disabled = false;
        el.loadBtn.textContent = '–ó–∞–≥—Ä—É–∑–∏—Ç—å —Å —Å–µ—Ä–≤–µ—Ä–∞';
      }
    });
    
    el.achievementsBtn.addEventListener('click', openAchievements);
    el.accessoriesBtn.addEventListener('click', openAccessories);
    el.capybarasBtn.addEventListener('click', openCapybaras);
    el.promocodeBtn.addEventListener('click', openPromocode);

    // –ö–Ω–æ–ø–∫–∏ –¥–ª—è –∫–µ–π—Å–æ–≤
    el.casesBtn.addEventListener('click', showCasesScreen);
    el.backToMenuBtn.addEventListener('click', showMainScreen);
    el.openCaseBtn.addEventListener('click', openCase);
    el.closeResultBtn.addEventListener('click', hideCaseOpeningAnimation);

    function selectCapybara(capyId) {
      if(state.capybarasOwned[capyId]) {
        state.currentCapybara = capyId;
        render();
        save();
        showToast(`–í—ã–±—Ä–∞–Ω–∞: ${capybaraNames[capyId]}`);
      }
    }

    function tryBuy(type){
      const prices = getPrices();
      const price = prices[type];
      if(state.balance < price) return;
      state.balance -= price;

      if(type === 'click') state.clickUpgrades++;

      if(type === 'auto1') state.auto1++;
      if(type === 'auto2') state.auto2++;
      if(type === 'auto3') state.auto3++;
      if(type === 'auto4') state.auto4++;
      if(type === 'auto5') state.auto5++;
      if(type === 'auto6') state.auto6++;
      if(type === 'auto7') state.auto7++;
      if(type === 'auto8') state.auto8++;
      if(type === 'auto9') state.auto9++;
      if(type === 'auto10') state.auto10++;

      if(type === 'multMyth'){
        state.multCount++;
        state.mythBought = true;
        showToast('‚ú® –ö—É–ø–ª–µ–Ω–æ: –ú–∏—Ñ–∏—á–µ—Å–∫–∞—è –∫–∞–ø–∏–±–∞—Ä–∞');
      }

      if(type === 'skinGlasses' && !state.accessoriesOwned.glasses){
        state.accessoriesOwned.glasses = true;
        state.accessoriesActive.glasses = true;
        showToast('–ö—É–ø–ª–µ–Ω –∞–∫—Å–µ—Å—Å—É–∞—Ä: –ú–æ–¥–Ω—ã–µ –æ—á–∫–∏ (–∫–∞–∂–¥—ã–µ 30 —Å–µ–∫ +3)');
        startGlassesTimer();
      }
      if(type === 'skinUshanka' && !state.accessoriesOwned.ushanka){
        state.accessoriesOwned.ushanka = true;
        state.regenRate = 1.05;
        showToast('–ö—É–ø–ª–µ–Ω –∞–∫—Å–µ—Å—Å—É–∞—Ä: –£—à–∞–Ω–∫–∞ (+5% –∫ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏)');
      }
      if(type === 'skinHat' && !state.accessoriesOwned.hat){
        state.accessoriesOwned.hat = true;
        showToast('–ö—É–ø–ª–µ–Ω –∞–∫—Å–µ—Å—Å—É–∞—Ä: –®–ª—è–ø–∞ (4% —à–∞–Ω—Å x2 –¥–æ—Ö–æ–¥ –∑–∞ –∫–ª–∏–∫)');
      }
      if(type === 'skinSuit' && !state.accessoriesOwned.suit){
        state.accessoriesOwned.suit = true;
        state.accessoriesActive.suit = true;
        showToast('–ö—É–ø–ª–µ–Ω –∞–∫—Å–µ—Å—Å—É–∞—Ä: –ö–æ—Å—Ç—é–º –∫–∞–ø–∏–±–∞—Ä—ã (–¥–æ—Ö–æ–¥ √ó1.1)');
      }

      if(type === 'capy2' && !state.capybarasOwned.capy2){
        state.capybarasOwned.capy2 = true;
        state.currentCapybara = 'capy2';
        showToast('–ö—É–ø–ª–µ–Ω–∞ –∫–∞–ø–∏–±–∞—Ä–∞: –•–æ–º—è–∫-–∫–∞–ø–∏–±–∞—Ä–∞! (+10% –∫ –¥–æ—Ö–æ–¥—É –∑–∞ –∫–ª–∏–∫)');
      }
      if(type === 'capy3' && !state.capybarasOwned.capy3){
        state.capybarasOwned.capy3 = true;
        state.currentCapybara = 'capy3';
        showToast('–ö—É–ø–ª–µ–Ω–∞ –∫–∞–ø–∏–±–∞—Ä–∞: –ö–æ—Ä–æ–ª–µ–≤—Å–∫–∞—è –∫–∞–ø–∏–±–∞—Ä–∞! (+20% –∫ –∞–≤—Ç–æ-–¥–æ—Ö–æ–¥—É)');
      }
      if(type === 'capy4' && !state.capybarasOwned.capy4){
        state.capybarasOwned.capy4 = true;
        state.currentCapybara = 'capy4';
        showToast('–ö—É–ø–ª–µ–Ω–∞ –∫–∞–ø–∏–±–∞—Ä–∞: –ö–∏–±–µ—Ä-–∫–∞–ø–∏–±–∞—Ä–∞! (√ó1.5 –∫ –º–Ω–æ–∂–∏—Ç–µ–ª—è–º)');
      }

      render(); save();
    }

    window.addEventListener('beforeunload', ()=>{
      state.lastExit = Date.now();
      state.offlineMiningTime = 0;
      save();
    });

    // –ó–∞–ø—É—Å–∫
    createSnowflakes();
    load();
    currentUserId = getUserId();
    lastLoadTime = Date.now();
    render();
    startAuto();
    startAutosave();
    startRegen();
    startGlassesTimer();
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Supabase
    (function() {
      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2';
      script.onload = function() {
        initSupabase();
        // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å —Å —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        setTimeout(async () => {
          const loaded = await loadFromSupabase();
          if (loaded) {
            render();
            showToast('–ü—Ä–æ–≥—Ä–µ—Å—Å –∑–∞–≥—Ä—É–∂–µ–Ω —Å –æ–±–ª–∞–∫–∞');
          }
        }, 1000);
      };
      script.onerror = function() {
        console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å Supabase –∫–ª–∏–µ–Ω—Ç');
        showToast('–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –æ–±–ª–∞–∫–µ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ');
      };
      document.head.appendChild(script);
    })();
  </script>
</body>
</html>